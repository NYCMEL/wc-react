#!/Melify/bin/mac/tclkit

namespace eval queue {
    set x [list]
    set ticks 0

    ######################################################
    ####
    ######################################################
    proc init {ticks} {
	set queue::x [list]
	set queue::ticks $ticks
    }

    ######################################################
    ####
    ######################################################
    proc add {val} {
	lappend queue::x $val

	if {[llength $queue::x] > $queue::ticks} {
	    set queue::x [lrange $queue::x end-[expr $queue::ticks -1] end]
	}
    }
    
    ######################################################
    ####
    ######################################################
    proc dir {} {
	if {[llength $queue::x] != $queue::ticks} {
	    return
	}

	set s1 [lsort -increasing -real $queue::x]
	set s2 [lsort -decreasing -real $queue::x]
	
	if {$s1 == $queue::x} {
	    return "BUY"
	}

	if {$s2 == $queue::x} {
	    return "SELL"
	}

	return ""
    }
}

######################################################
####
######################################################
proc buy {price} {
    puts "BUY > $price"
}

######################################################
####
######################################################
proc sell {price} {
    puts "SELL > $price"
}

######################################################
####
######################################################
proc process {} {
    switch [queue::dir] {
	"BUY" {
	    puts "B > [lindex $queue::x end]"

	    # INITIALIZE
	    queue::init $queue::ticks
	}
	"SELL" {
	    puts "S > [lindex $queue::x end]"

	    # INITIALIZE
	    queue::init $queue::ticks
	}
    }
}

######################################################
####
######################################################
queue::init 3

queue::add 4.0
queue::add 5.0
queue::add 10.0
queue::add 55.0
queue::add 65.0
process

queue::add 90.0
queue::add 65.0
queue::add 55.0
queue::add 5.0
process

queue::init 5.0
queue::add 55.0
queue::add 65.0
queue::add 10.0
process
