#!/Melify/bin/mac/tclkit

set date "2019-11-19"
set nticks 4
set symbol "AAPL"

############################
set u 0
set d 0
set p 0
set t 0
set v 0

source "~/Dropbox/Trader/stocks/$symbol/$date/$symbol.txt"

set cnt 0

puts [format "%s\t%s\t\t%s\t%s" "" "PRICE" "VOLUME" "TIME"]

foreach k [dict key $stocks] {
    foreach {i j} [dict get $stocks $k] {
	set a($i) $j
    }
    
    #if {[incr cnt] > 20} exit;#TMP
    
    set t $a(quoteTimeInLong)
    set v $a(totalVolume)

    if {$a(lastPrice) > $p} {
	# PRICE IS UP
	incr u; set d 0
	set p $a(lastPrice)
    } elseif {$a(lastPrice) < $p} {
	# PRICE IS DOWN
	incr d; set u 0
	set p $a(lastPrice)
    }

    if {$u == 4} {
	puts [format "%s\t%0.4f0\t%d\t%d" "BUY" $p $v $t]
	#puts "BUY $p $v $t";exit
	set u 0;set d 0
    }

    if {$d == 4} {
	puts [format "%s\t%0.4f0\t%d\t%d" "SEL" $p $v $t]
	#puts "BUY $p $v $t";exit
	set u 0;set d 0
    }
}

