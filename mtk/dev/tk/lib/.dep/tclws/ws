#!/Melify/bin/mac/tclkit

source /GitHub/tcllib/modules/websocket/websocket.tcl

package require websocket
::websocket::loglevel debug

proc handler { sock type msg } {
    switch -glob -nocase -- $type {
	co* {
	    puts "Connected on $sock"
	}
	te* {
	    puts "RECEIVED: $msg"
	}
	cl* -
	dis* {
	}
    }
    
}
proc test { sock } {
    puts "[::websocket::conninfo $sock type] from [::websocket::conninfo $sock sockname] to [::websocket::conninfo $sock peername]"
    
    ::websocket::send $sock text "Testing, [clock seconds]..."
}

set sock [::websocket::open ws://echo.websocket.org/ handler]
after 400 test $sock
vwait forever
