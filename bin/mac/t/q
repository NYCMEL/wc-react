#!/Melify/bin/mac/tclkit

set date "2019-11-19"
set nticks 9
set symbol "AAPL"

############################
set u 0
set d 0
set p 0
set t 0
set v 0

source "~/Dropbox/Trader/stocks/$symbol/$date/$symbol.txt"

set cnt 0

puts "------------------------------------------------------------------------"
puts "  X PRICE     VOLUME  TIME            BIDs  ASKs  BIDp        ASKp"
puts "------------------------------------------------------------------------"

foreach k [dict key $stocks] {
    foreach {i j} [dict get $stocks $k] {
	set a($i) $j
    }
    
    if {$a(lastPrice) > $p} {
	# PRICE IS UP
	incr u; set d 0
	set p $a(lastPrice)
    } elseif {$a(lastPrice) < $p} {
	# PRICE IS DOWN
	incr d; set u 0
	set p $a(lastPrice)
    }

    set fmt "%3s %5.4f0 %d %d %5d %5d %10.4f0 %10.4f0"

    if {$u == $nticks} {
	puts [format $fmt "B" $p $a(totalVolume) $a(quoteTimeInLong) $a(bidSize) $a(askSize) $a(bidPrice) $a(askPrice)]
	set u 0;set d 0
    }

    if {$d == $nticks} {
	puts [format $fmt "S" $p $a(totalVolume) $a(quoteTimeInLong) $a(bidSize) $a(askSize) $a(bidPrice) $a(askPrice)]
	set u 0;set d 0
    }
}

