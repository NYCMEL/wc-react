#!/Melify/bin/mac/tclkit

set date "2019-11-19"
set nticks 9
set symbol "AAPL"

############################

for {set nticks 3} {$nticks < 10} {incr nticks} {
    set u 0
    set d 0
    set p 0

    set f [open ./compare/$nticks.dat w]

    source "~/Dropbox/Trader/stocks/$symbol/$date/$symbol.txt"

    puts "ticks = $nticks"
    
    puts $f "ticks = $nticks"
    puts $f "------------------------------------------------------------------------"
    puts $f "  X PRICE     VOLUME  TIME            BIDs  ASKs  BIDp        ASKp"
    puts $f "------------------------------------------------------------------------"

    foreach k [dict key $stocks] {
	foreach {i j} [dict get $stocks $k] {
	    set a($i) $j
	}
	
	if {$a(lastPrice) > $p} {
	    # PRICE IS UP (SELL)
	    incr u; set d 0
	    set p $a(lastPrice)
	} elseif {$a(lastPrice) < $p} {
	    # PRICE IS DOWN (BUY)
	    incr d; set u 0
	    set p $a(lastPrice)
	}

	set fmt "%3s %5.4f0 %d %d %5d %5d %10.4f0 %10.4f0"

	if {$u == $nticks} {
	    puts $f [format $fmt "S" $p $a(totalVolume) $a(quoteTimeInLong) $a(bidSize) $a(askSize) $a(bidPrice) $a(askPrice)]
	    set u 0;set d 0
	}

	if {$d == $nticks} {
	    puts $f [format $fmt "B" $p $a(totalVolume) $a(quoteTimeInLong) $a(bidSize) $a(askSize) $a(bidPrice) $a(askPrice)]
	    set u 0;set d 0
	}
    }

    close $f
}
