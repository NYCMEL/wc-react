#!/Melify/bin/mac/tclkit

if {$argc != 1} {
    puts "\nusage: page <file.name>\n"
    exit
}

puts "\n---------------------------------------------------"
puts "1) Making a new file \"$argv\". Please wait..."

#regsub -all "::" $argv "." tmp

if {[file extension $argv] == ".tcl"} {
    set fname "$argv"
} else {
    set fname "$argv.tcl"
}

set tmp [string range $fname 0 end-4]

set x [split $tmp "."]
set s ""
foreach i $x {
    append s "namespace eval $i \{\n"
}
foreach i $x {
    append s "\}\n"
}

set f [open /Melify/bin/data/page.template.tcl r]
set r [read $f]
close $f

regsub -all {\.} $tmp "::" x

# CREATE PAGE ID
regsub -all "::" "${x}" "-" y
regsub -all "APAGEID" $r "${y}" r

#CREATE NAMESPACE
regsub "namespace eval APAGE {}" $r "$s" r
regsub -all "APAGE"   $r "${x}" r

set f [open $fname w]
puts $f $r
close $f

puts "2) Created the file."
puts "3) Registering the file now..."

if {[catch {
    exec chmod 777 $fname
    exec /Melify/bin/mac/tclkit /Melify/bin/make/u
} e] != 0} {
    puts $e
}

puts "  > Your file is ready";flush stdout
puts "---------------------------------------------------\n"
