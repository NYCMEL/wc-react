#!/Melify/bin/mac/tclkit

if {$argc != 1} {
    puts "\nUSAGE: codegen <file-name>\n"
    exit
}

lappend auto_path "/Melify/mtk/dev/tk/src/utl"

######################################################
##### 
######################################################
set fi [open $argv r]
set fo stdout
set save 1

######################################################
##### 
######################################################
proc generate {line} {
    global fi fo

    puts $fo $line
    puts $fo "GENERATED CODE GOES HERE"
}

######################################################
##### 
######################################################
proc process {line} {
    global fi fo

    #CLEAR ALL PRIOR CODE
    while {[gets $fi tmp] >= 1} {
	if {[string first "</mtk>" $tmp] !=-1} {
	    generate $line
	    break
	}
    }

    puts $fo "</mtk>"
}

while {[gets $fi line] >= 1} {
    if {$save == 1} {puts $fo $line}

    set line [string trim $line]

    if {[string first "<mtk " $line] !=-1} {
	#FOUND A COMPONENT
	process $line
    }
}

